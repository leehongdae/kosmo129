<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
          "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 
<mapper namespace="a.b.c.com.kos.board.dao.KosBoardDAO">
	
	<!-- Insert  -->
	<insert id="kosBoardInsert" parameterType="kosboardvo">
		
		INSERT INTO SPRING_BOARD 
			(
			 BNUM, BSUBJECT, BNAME, 
			 BCONTENT, BFILE, BPW, 
			 DELETEYN, INSERTDATE, UPDATEDATE
			)
		VALUES
			(
			 #{bnum, jdbcType=VARCHAR}, #{bsubject, jdbcType=VARCHAR}, #{bname, jdbcType=VARCHAR},
			 #{bcontent, jdbcType=VARCHAR}, #{bfile, jdbcType=VARCHAR}, #{bpw, jdbcType=VARCHAR},
			'Y', SYSDATE, SYSDATE
			)
			
	</insert>
	
	<select id="kosBoardSelectAll" parameterType="kosboardvo" resultType="kosboardvo">
	
	SELECT * FROM (
		SELECT 
				 A.BNUM 	BNUM
				,A.BSUBJECT BSUBJECT
				,A.BNAME 	BNAME
				,A.BCONTENT BCONTENT
				,A.BFILE 	BFILE
				,A.BPW 		BPW
				,A.DELETEYN DELETEYN
				,TO_CHAR(A.INSERTDATE, 'YYYY-MM-DD') INSERTDATE
				,TO_CHAR(A.UPDATEDATE, 'YYYY-MM-DD') UPDATEDATE
				,A.BHIT 	BHIT
				,CEIL(ROW_NUMBER() OVER(ORDER BY A.BNUM)/${groupSize}) pageSize
				,COUNT(A.BNUM) OVER() totalCount			
		FROM 	SPRING_BOARD A
		WHERE 	DELETEYN = 'Y'
		ORDER 	BY 1 DESC 
		) WHERE pageSize = #{curPage}
		
	</select>
	
	<select id="kosBoardSelect" parameterType="kosboardvo" resultType="kosboardvo">
		
		SELECT 	A.BNUM 			BNUM
		       ,A.BSUBJECT 		BSUBJECT
		       ,A.BNAME 		BNAME
		       ,A.BCONTENT 		BCONTENT
		       ,A.BFILE 		BFILE
		       ,A.BPW 			BPW		   
		       ,A.DELETEYN 		DELETEYN
		       ,TO_CHAR(A.INSERTDATE, 'YYYY-MM-DD') INSERTDATE
		       ,TO_CHAR(A.UPDATEDATE, 'YYYY-MM-DD') UPDATEDATE
		       ,A.BHIT      	BHIT 	
		       ,B.BLNUM 		BLNUM
		       ,B.LIKE_CNT_1	LIKE_CNT_1
		       ,B.LIKE_CNT_2	LIKE_CNT_2      
		<!-- 
			FROM 	SPRING_BOARD A
			FULL OUTER JOIN SPRING_BOARD_LIKE B
			ON   A.BNUM = B.BNUM
			WHERE 	A.DELETEYN = 'Y' 
			AND     A.BNUM = #{bnum}	
		 -->       
		FROM 	SPRING_BOARD A, SPRING_BOARD_LIKE B		
		WHERE 	A.BNUM = B.BNUM(+)
		AND     A.DELETEYN = 'Y' 
		AND     A.BNUM = #{bnum}
		
	</select>
	
	<update id="kobBoardBhit" parameterType="kosboardvo">
		
		UPDATE SPRING_BOARD
			 SET BHIT = (SELECT NVL(MAX(BHIT), 0) + 1 FROM SPRING_BOARD WHERE DELETEYN = 'Y' AND BNUM = #{bnum})
		WHERE DELETEYN = 'Y'
		AND BNUM = #{bnum}
	</update>
	
	<update id="kosBoardUpdate" parameterType="kosboardvo">
	
		UPDATE  SPRING_BOARD
		   SET  BCONTENT 	= #{bcontent}
			   ,UPDATEDATE  = SYSDATE
		WHERE 	DELETEYN 	= 'Y'
		AND 	BNUM = #{bnum}
	</update>
	
	<update id="kosBoardDelete" parameterType="kosboardvo" >

		UPDATE  SPRING_BOARD
	   	   SET	DELETEYN 	= 'N'
	      	   ,UPDATEDATE  = SYSDATE
		WHERE  	DELETEYN    = 'Y'
		AND    	BNUM = #{bnum}	
	</update>
	
	<select id="kosBoardPwCheck" parameterType="kosboardvo" resultType="kosboardvo">
		
		SELECT  A.BNUM BNUM
			   ,A.BPW  BPW
		FROM 	SPRING_BOARD A
		WHERE 	DELETEYN = 'Y'
		AND		A.BNUM = #{bnum}
		AND 	A.BPW = #{bpw}
		
	</select>
	
	
</mapper> 